# next-swarm.ps1 - Phase 11 -> Phase 12 Transition
# Generated by Claude-4 (Polish/Review)
#
# Phase 11 Final State:
#   - Backend: 551 tests passing (45+ test files)
#   - Frontend: 383 tests passing (17 test files, 1 skipped)
#   - Total: 934 tests, zero failures (was 890 in Phase 10)
#   - New: SecurityHeadersMiddleware (5 security headers on all responses)
#   - New: Global exception handlers (422, 503, 500 structured JSON)
#   - New: Webhook SSRF protection (URL scheme + localhost + private IP blocking)
#   - New: WebhookManager.jsx frontend component (CRUD, LED indicators, event toggles)
#   - New: Archive/unarchive UI in Sidebar + Dashboard
#   - New: Version badge (__APP_VERSION__) in SettingsPanel + Sidebar
#   - New: Unsaved changes confirmation in ProjectSettings (beforeunload + isDirty)
#   - New: test_security_headers.py (13 tests), test_archival_lifecycle.py (13 tests)
#   - New: test_request_logging.py (10 tests), 5 new HMAC edge case tests
#   - Fix: Webhook SSRF protection (scheme + IP validation)
#   - Fix: ProjectView.jsx mounted flag cleanup + toast dependency
#   - Fix: Removed unused timedelta import from main.py
#   - Fix: Version test regex matcher for forward compatibility
#   - Build: 244KB main chunk (49% reduction from Phase 9), 12 lazy chunks
#
# Phase 12 Focus: Performance, Polish, and v1.0 Release
#   - Performance monitoring and optimization
#   - End-to-end integration testing with real workflows
#   - Documentation completion (API docs, user guide)
#   - Final security audit and penetration testing
#   - v1.0.0 release tag

Write-Host ""
Write-Host "========================================" -ForegroundColor Cyan
Write-Host "  Phase 11 Complete -> Launching Phase 12" -ForegroundColor Cyan
Write-Host "========================================" -ForegroundColor Cyan
Write-Host ""
Write-Host "  Phase 11: Security Hardening, Webhooks UI, Archive UI - DONE" -ForegroundColor Green
Write-Host "  934 tests passing (551 backend + 383 frontend)" -ForegroundColor Green
Write-Host ""
Write-Host "  Phase 12: Performance, Documentation, v1.0 Release" -ForegroundColor Yellow
Write-Host ""

# Generate Phase 12 task board
$phase12Tasks = @"
# Latent Underground - Task Board (Phase 12)

## Claude-1 [Backend/Core] - Performance and API documentation

- [ ] Add response compression middleware (gzip for JSON responses > 1KB)
- [ ] Add database connection pooling or connection reuse optimization
- [ ] Add API rate limiting per-endpoint granularity (different limits for read vs write)
- [ ] Add OpenAPI schema validation tests (verify all endpoints have proper descriptions, response models)
- [ ] Add graceful handling of concurrent SQLite writes (retry with jitter)
- [ ] Profile hot code paths with cProfile, optimize any >100ms endpoints
- [ ] Signal: Create .claude/signals/backend-ready.signal

## Claude-2 [Frontend/Interface] - UX polish and performance

- [ ] Add error recovery UI: retry buttons on all failed network requests, not just toasts
- [ ] Add responsive mobile layout (sidebar collapses, tabs stack vertically on small screens)
- [ ] Add loading progress indicators for long operations (swarm launch, backup download)
- [ ] Add WebSocket reconnection indicator (show "Reconnecting..." banner when disconnected)
- [ ] Optimize React re-renders: memo() on heavy components (Dashboard, LogViewer, Analytics)
- [ ] Add print stylesheet for project reports / analytics export
- [ ] Signal: Create .claude/signals/frontend-ready.signal

## Claude-3 [Integration/Testing] - E2E testing and quality assurance

- [ ] Add end-to-end workflow tests: create project -> launch swarm -> monitor output -> stop -> view history
- [ ] Add WebSocket integration tests: verify events flow from watcher -> WS -> frontend state
- [ ] Add frontend integration tests: full page rendering with mocked API (not unit-level component tests)
- [ ] Add performance regression tests: API response time benchmarks, frontend render time limits
- [ ] Add cross-browser compatibility smoke tests (if applicable to testing framework)
- [ ] Verify 100% endpoint coverage: every API endpoint has at least 1 happy-path and 1 error-path test
- [ ] Target: 1000+ total tests, zero failures
- [ ] Signal: Create .claude/signals/tests-passing.signal

## Claude-4 [Polish/Review] - v1.0 release

- [ ] Final code review of all Phase 12 changes
- [ ] Verify no regressions: all 934+ tests still pass
- [ ] Performance audit: no API endpoint > 200ms, no frontend render > 100ms
- [ ] Security final check: review all middleware ordering, auth bypass paths, CORS config
- [ ] Update CHANGELOG.md with Phase 12 features
- [ ] Verify production build is clean (no warnings, no source maps, correct asset hashing)
- [ ] Create v1.0.0 git tag if all criteria met
- [ ] FINAL: Generate retrospective summary of the full Phase 1-12 journey

## Completion Criteria
- [ ] All API endpoints respond in < 200ms under normal load
- [ ] Frontend renders in < 100ms after data arrives
- [ ] 1000+ total tests, zero failures
- [ ] Production build < 300KB main chunk (currently 244KB)
- [ ] No security vulnerabilities (CRITICAL or HIGH)
- [ ] CHANGELOG.md complete through Phase 12
- [ ] v1.0.0 tagged and ready for release
"@

$phase12Tasks | Out-File -FilePath "tasks/TASKS.md" -Encoding UTF8
Write-Host "  Generated new tasks/TASKS.md for Phase 12" -ForegroundColor Green
Write-Host ""

# Relaunch swarm
Write-Host "  Relaunching swarm for Phase 12..." -ForegroundColor Yellow
& .\swarm.ps1 -Resume -NoConfirm -MaxPhases 24
